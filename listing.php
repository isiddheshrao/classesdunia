<?php
require 'connect.php';
require 'helper.php';
?>
<!DOCTYPE html>
<html lang="en">
<head>

	<!-- Meta -->
	<meta charset="utf-8">
	<meta name="keywords" content="HTML5 Template" />
	<meta name="description" content="Listingpro - Template HTML5">
	<meta name="author" content="">

	<!-- Title -->
	<title>ClassesDunia - Home</title>

	<!-- Mobile Meta -->
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<!-- Favicon -->
	<link rel="shortcut icon" href="images/favicon.png" type="image/x-icon">

	<!-- CSS -->
	<link href="lib/bootstrap/css/bootstrap.css" type="text/css" rel="stylesheet" />
	<link href="css/colors.css" type="text/css" rel="stylesheet" />
	<link href="css/font.css" type="text/css" rel="stylesheet" />
	<link href="lib/popup/css/component.css" type="text/css" rel="stylesheet" />
	<link href="lib/icon8/styles.min.css" type="text/css" rel="stylesheet" />
	<link href="lib/font-awesome/css/font-awesome.min.css" type="text/css" rel="stylesheet" />
	<link type="text/css" rel="stylesheet" href="lib/jquerym.menu/css/jquery.mmenu.all.css" />
	<link href="css/main.css" type="text/css" rel="stylesheet" />
	<link href="css/stylefooter.css" rel="stylesheet" type="text/css" />
<link href="css/bootstrapfooter.css" rel="stylesheet" type="text/css" />
	<!-- IE8 support of HTML5 elements and media queries -->
	<!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
	<![endif]-->
</head>
<body class="listing"  data-userimg="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAEGUlEQVRoge1ZLWwcRxQ+cMCVItXAIKDgQKQaGBQYtFLBm4mBgYFBQSoZGBgYGAQYFBhYOhAQYBBgqa204G7fWGdg4EqWUrCwqgpcqYoiy975xnKlAIMDAQYGWzAzd6vmfnb39rxX1Z+07L2n7828N+9na7VHPOK/A2IsEusNCuN9qRBIhUMK9S4x1inAXNX8RoKiqE5tbAuF3wQjGfGd09HVUtV8B4I6754IxlmfrLlxt7BHITYp1DtSmTdCmUsncyeVeU2Mxaq590AB5gSbv7wD1I7XKIrqA2WjqC7Z/JS+IanMm2HyDwqpzGvnxB/UwdNx8hRFdVLxslSmKdjcWmcQPATX4aQUGoLNvWBzXyTuibEoGF3BSCjEV9PgmI1IG9suPI4L2wjjfcFIJEOVyS0XJOPEneZmURt0dLXk8gUlUssHwYgEI6EWaEI7iWAkJdEqQMA9p6TQmMhO5Y64Z3eSRKUA8zPgiP7FJer3hW209JeCkQhl/i6TWy744kaMH4raoDa+9q1LmdzykQj1riuGPxa1IZXZdbd6UCa3XKCj6zVH4m1hG6yPBSN5ztcbZXLLSQKrLiy6xfQvFmxngITCeKVsfpnhO14K9V4RfdtE4pW71ZOy+WWGYLwXjGSS+YJaIHerUZncckEqc2xfLV04vinE5qT92sQg1hu+T6JQ7+bWD/WeYGDSw5gYFEV1qcypK2iXefV9Cy8YZ5UPV990bj4TjD/tqcbfZtUT6vq5c+L3afLLBakQuDhvZtcxTTcdHk6TWy6kXp4uBZgfK28bxW4ZI0Dp8LOJVOZ0VLy72nFS+ZM7DNSO11KbkVPii4VPZALMp5xISMXLVXAdCbfbukvttm6J9RYpNEihQay3BJub9O6ras5D4WuCr/gDv/6SrroZfRx6DSBfLBDrDRtG5sbtr86ojW1qXT2baUdS25C7kXIdPPVyM7UyrdVqNVLxsg+nLAOSZNPyITgTCU9HV0u2GNqQco68Gqtneyyf9PdSIXjwTaP9faC/6/VYnozNB7s+DfFiqH4Yr3g5ezP9QxCMMwrxYqr/UCjAHDFe+sWzr+SScUCtq2e1Wr/t6G3Z2/GaTfyLBWKsSsZBr4a4YYwUGm4R3hXppzuM97N0CfmcsO36h5QD7ynUO9R59+QT2VDvCDYfhz6/NslfDjyoNrb7vyhcyzNANr8DUVSXCocpw+fEWB/vOBalMk0bfuZWsLmVypxKZZpZpklirAvGeT/vTGvQoWVGPw/MR2K9VdhQQdhI6N1uVGhm8SOoYMDnQBVwBRQur/JNodS+/KLXZjNWp8QxO5/+mHCXa2Huf+AINr9Oj14++DDPlfxCmZ9zK00ZMjQ7bknRyqz0r6d21r4PmZxI/6+Y1W+lE39e9GYf8Yj/K/4BSKKZsGt5SOsAAAAASUVORK5CYII=" data-userlink ="login.html">
	<div id="page">
	<!--==================================Header Open=================================-->
	<header class="lp-header-bg">
		<div class="lp-header-overlay"></div>
		<div class="md-overlay"></div> <!-- Overlay for Popup -->
		<div class="lp-menu-bar">
			<div class="container">
					<div class="row">
						<div class="col-md-4 col-xs-6 lp-logo-container">
							<div class="lp-logo">
								<a href="index.php">
									<img src="images/logo.png" alt="" />
								</a>
							</div>
						</div>
						<style>
							.mobile-nav-icon .nav-icon {
    													width: 28px;
   														float: right;
   													}
						</style>
						<div class="col-xs-6 mobile-nav-icon">
							<a href="#menu" class="nav-icon">
								<span class="icon-bar"></span>
								<span class="icon-bar"></span>
								<span class="icon-bar"></span>
							</a>
						</div>

							<div id="menu">
								<ul>
									<li><a href="index.php">Home</a></li>
									<li><a href="#">Categories </a>
										<ul class="sub-menu">
											<li class="has-menu"><a href="listing-science.html">Science </a>
												<ul class="sub-menu">
													<li><a href="listing-science.html">HSC </a></li>
													<li><a href="listing-science.html">Diploma </a></li>
													<li><a href="listing-science.html">Engineering </a></li>
													<li><a href="listing-science.html">Medical</a></li>
												</ul>
											</li>
											<li class="has-menu"><a href="listing-commerce.html">Commerce </a>
												<ul class="sub-menu">
													<li><a href="listing-commerce.html">CA </a></li>
													<li><a href="listing-commerce.html">CS </a></li>
												</ul>
											</li>
											<li><a href="listing-design.html">Design </a></li>

											<li class="has-menu"><a href="listing-entrance.html">Entrance </a>
												<ul class="sub-menu">
													<li><a href="listing-entrance.html">GATE </a></li>
													<li><a href="listing-entrance.html">JEE </a></li>
													<li><a href="listing-entrance.html">CET </a></li>
												</ul>
											</li>
											<li class="has-menu"><a href="listing-school.html">School </a>
												<ul class="sub-menu">
													<li><a href="listing-school.html">SSC </a></li>
												</ul>
											</li>
											</ul>
											</li>
											<li>
												<a href="#">Blog</a>
											</li>
											<li>
												<a href="about-us.html">About Us </a></li>
											<li>
												<a href="contact-us.html">Contact Us </a>
											</li>
										</ul>
									</div>

						<div class="col-md-8 col-xs-12 lp-menu-container">
							<div class="lp-menu pull-right menu">
								<ul>
									<li><a href="index.php">Home </a></li>
									<li><a href="#">Categories <i class="icons8-angle-down drop-down-icon"></i></a>
										<ul class="sub-menu">
											<li class="has-menu"><a href="listing-science.html">Science </a>
												<ul class="sub-menu">
													<li><a href="listing-science.html">HSC </a></li>
													<li><a href="listing-science.html">Diploma </a></li>
													<li><a href="listing-science.html">Engineering </a></li>
													<li><a href="listing-science.html">Medical</a></li>
												</ul>
											</li>
											<li class="has-menu"><a href="listing-commerce.html">Commerce </a>
												<ul class="sub-menu">
													<li><a href="listing-commerce.html">CA </a></li>
													<li><a href="listing-commerce.html">CS </a></li>
												</ul>
											</li>
											<li><a href="listing-design.html">Design </a></li>

											<li class="has-menu"><a href="listing-entrance.html">Entrance </a>
												<ul class="sub-menu">
													<li><a href="listing-entrance.html">GATE </a></li>
													<li><a href="listing-entrance.html">JEE </a></li>
													<li><a href="listing-entrance.html">CET </a></li>
												</ul>
											</li>
											<li class="has-menu"><a href="listing-school.html">School </a>
												<ul class="sub-menu">
													<li><a href="listing-school.html">SSC </a></li>
												</ul>
											</li>
										</ul>
									</li>
									<li><a href="#">Blog</a>
									</li>
									<li><a href="about-us.html">About Us </a></li>
									<li>
										<a href="contact-us.html">Contact Us </a>
									</li>
								</ul>
							</div>
						</div>
					</div>
				</div>
		</div><!-- ../menu-bar -->
		<div class="page-heading listing-page archive-page ">
			<div class="page-heading-inner-container text-center">
				<h1>Class Search</h1>
				<ul class="breadcrumbs">
					<li><a href="index.php">Home</a></li>
					<li><span>Classes</span></li>
				</ul>
			</div>
			<div class="page-header-overlay"></div>
		</div><!-- ../Home Search Container -->
	</header>
	<!--==================================Header Close=================================-->

	<!--==================================Section Open=================================-->
	<section>
		<div class="container page-container">
			<div class="row">
				<div class="col-md-12 search-row margin-top-subtract-35  margin-bottom-35">
					<form class="form-inline clearfix" method="post">
						<!-- <div class="form-group">
							<div class="input-group">
								<div class="input-group-addon lp-border"><i class="fa fa-search"></i></div>
									<input type="text" class="form-control lp-border input-width-299 border-right-radius" id="searchInput" placeholder="What is your Interest?">
							</div>
						</div> -->
						<div class="form-group">
							<div class="input-group">
								<div class="input-group-addon lp-border"><i class="fa fa-crosshairs"></i></div>
									<div class="ui-widget border-dropdown">
									  <select class="comboboxs" data-name="location">
										<option value="">Your Location</option>
										<option value="All">All Locations</option>
										<?php
											try {

												$conn = new PDO("mysql:host=".DB_SERVER.";dbname=".DB_NAME, DB_USER, DB_PASSWORD);
												$conn->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);

												// Case - I : location based search

												$stmt = $conn->prepare('SELECT loc FROM locations');
												$stmt->execute();
												if($stmt->rowCount()>0)
												{
													while($row = $stmt->fetch())
													{
															echo '<option value="'.$row['loc'].'">'.$row['loc'].'</option>';
													}
												}
										?>
									  </select>
									</div>
							</div>
						</div>
						<div class="form-group">
							<div class="input-group">
								<div class="input-group-addon lp-border"><i class="fa fa-list"></i></div>
									<div class="ui-widget streambox border-dropdown">
									  <select id="comboboxCategory" data-name="stream">
										<option value="">Your Streams</option>
										<option value="All">All Streams</option>
										<?php
												$stmt = $conn->prepare('SELECT ssname FROM substream');
												$stmt->execute();
												if($stmt->rowCount()>0)
												{
													while($row = $stmt->fetch())
													{
															echo '<option value="'.$row['ssname'].'">'.$row['ssname'].'</option>';
													}
												}
										?>
									  </select>
									</div>

							</div>
						</div>
						<div class="form-group">
							<div class="input-group">
								<div class="input-group-addon lp-border"><i class="fa fa-tag"></i></div>
									<div class="ui-widget subjectbox border-dropdown">
									  <select class="comboboxs" data-name="subject">
										<option value="">Your Subject</option>
										<option value="All">All Subjects</option>
										<?php
													$stmt = $conn->prepare('SELECT sname FROM subject');
													$stmt->execute();
													if($stmt->rowCount()>0)
													{
														while($row = $stmt->fetch())
														{
															echo '<option value="'.$row['sname'].'">'.$row['sname'].'</option>';
														}
													}

											}
											catch(PDOException $e) {
													echo 'ERROR: ' . $e->getMessage();
											}
										?>
									  </select>
									</div>
							</div>
						</div>

						<!--  this one is the tags chosen, will look into this later
						<div class="form-group margin-right-0">
							<div class="input-group margin-right-0">
								<div class="input-group-addon lp-border"><i class="fa fa-tag"></i></div>
									<select data-placeholder="Select Subjects" class="chosen-select tag-select-one" multiple >
									// php code to load subject options the one in above subject dropdown
									</select>
							</div>
						</div> -->

						<div class="lp-search-bar-right">
							<input type="submit" value="Search" class="lp-search-btn" />
							<i class="icons8-search lp-search-icon"></i>
						</div>

					</form>
				</div>
			</div>
			<div class="row">
				<div class="col-md-12">
					<div class="LPtagsContainer "></div>
				</div>
			</div>

			<div class="row lp-list-page-grid">
<?php

// TODO : empty check should also be performed


if (isset($_POST['location']) && isset($_POST['stream']) && isset($_POST['subject']))
{
		// cleanStringLow finds all special characters(except whitespace \s) and replaces them with ""(nothing)

		//echo 'Location: '.$_POST['location'].' Stream: '.$_POST['stream'] .' Subject: '.$_POST['subject'];


		$location = cleanStringLow($_POST['location']);

		$stream = cleanStringLow($_POST['stream']);

		$subject = cleanStringLow($_POST['subject']);

		$all = 'all-';

		if( strpos( $location, $all ) !== false ) {
			$location = "";
		}

		if( strpos( $stream, $all ) !== false ) {
			$stream = "";
		}

		if( strpos( $subject, $all ) !== false ) {
			$subject = "";
		}

		//echo 'Location: '.$location.' Stream: '.$stream .' Subject: '.$subject;

		// let start developing for most simple case first which is

		// case I : user passes value to all three dropdowns

		// so check whether values are all or null will be done later

		// assuming user gives valid values to all the fields,

		// simply pull the data by joining the three tables

		try {

			    $conn = new PDO("mysql:host=".DB_SERVER.";dbname=".DB_NAME, DB_USER, DB_PASSWORD);

			    $conn->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);

					// old-stmt
					//$stmt = $conn->prepare('SELECT a.cname,a.location,a.logourl,a.pageurl,b.ssname,c.sname FROM classes a, substream b, subject c, map_class_stream d, map_class_subject e WHERE a.classid = d.class_id AND b.ssid=d.stream_id AND a.classid = e.class_id AND c.subjectid = e.subject_id AND c.fstream = b.ssname AND a.location LIKE :location AND b.ssname LIKE :stream AND c.sname LIKE :subject');

			    $stmt = $conn->prepare('SELECT DISTINCT a.cname,a.location,a.logourl,a.pageurl FROM classes a, substream b, subject c, map_class_stream d, map_class_subject e WHERE a.classid = d.class_id AND b.ssid=d.stream_id AND a.classid = e.class_id AND c.subjectid = e.subject_id AND c.fstream = b.ssname AND a.location LIKE :location AND b.ssname LIKE :stream AND c.sname LIKE :subject');

			    $stmt->execute(array('location' => '%'.$location.'%', 'stream' => '%'.$stream.'%', 'subject' => '%'.$subject.'%'));

			    //var_dump($stmt);

				if($stmt->rowCount()>0)
				{

					echo '<div class="row listing-page-result-row margin-bottom-25">
						<div class="col-md-4 col-sm-4 text-left">
							<p>'.$stmt->rowCount().' Results</p>
						</div>
						<div class="col-md-4 col-sm-4  text-center">
							<p class="view-on-map">
								<!-- view on map was here -->
							</p>
						</div>
						<div class="col-md-4 col-sm-4  text-right">
							<p>Showing all Class Listings <a href="#" class="achor-color">Reset</a></p>
						</div>
					</div>';



					while($row = $stmt->fetch())
					{

					    	echo	'<div class="col-md-3 col-sm-6 lp-grid-box-contianer lp-grid-box-contianer1" data-title="The Dorchester grill" data-reviews="4" data-number="+007-123-4567-89" data-email="jhonruss@example.com" data-website="www.example.com" data-price="$200" data-pricetext="Text about your price" data-description="Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium doloremque laudantium, totam rem aperiam eaque ipsa quae ab illo inventore veritatis et quasi archeum" data-userimage="images/user-thumb-94x94.png" data-username="Jhon Russel" data-userlisting="14" data-fb="www.facebook.com" data-gplus="www.plus.google.com" data-linkedin="www.linkedin.com" data-instagram="www.instagram.com" data-twitter="www.twitter.com" data-lattitue="40.6700" data-longitute="-73.9400"  data-id="11"  data-posturl="post-detail.html" data-authorurl="author.html">
										<div class="lp-grid-box lp-border lp-border-radius-8">
											<div class="lp-grid-box-thumb-container" >
												<div class="lp-grid-box-thumb">
													<img src="images/grid/'.$row['logourl'].'" alt="grid-1" />
												</div><!-- ../grid-box-thumb -->
												<div class="lp-grid-box-quick">
													<ul class="lp-post-quick-links">
														<li>
															<a class="icon-quick-eye md-trigger" data-modal="modal-2"><i class="fa fa-eye"></i></a>
														</li>
													</ul>
												</div><!-- ../grid-box-quick-->
											</div>
											<div class="lp-grid-box-description ">
												<h4 class="lp-h4">
													<a href="'.$row['pageurl'].'">
													'.$row['cname'].'
													</a>
												</h4>
												<p>
													<i class="fa fa-map-marker"></i>
													<span><b>'.$row['location'].'</b></span>
												</p>
											</div><!-- ../grid-box-description-->
											<div class="lp-grid-box-bottom">
												<!--<div class="pull-left">
													<i class="fa fa-star"></i>
													<i class="fa fa-star"></i>
													<i class="fa fa-star"></i>
													<i class="fa fa-star"></i>
													<i class="fa fa-star-o"></i>
													<span class="rating-ratio">4.0</span>
												</div>
												<div class="pull-right">
													<a href="#" class="lp-add-to-fav simptip-position-top simptip-movable" data-tooltip="Add to favorites">
													<i></i>
													</a>
												</div>
												<div class="clearfix"></div>-->
											</div><!-- ../grid-box-bottom-->
										</div><!-- ../grid-box -->
									</div>';


					}

					    // Toss back results as json encoded array.
			    		//echo json_encode($return_arr);
				}
				else
				{
					echo '<h1>No Class Found</h1>';
				}

		}
		catch(PDOException $e) {
			    echo 'ERROR: ' . $e->getMessage();
		}

}


?>
		</div>
		</div>
	</section>
	<!--==================================Section Close=================================-->

	<!--==================================Footer Open=================================-->
	<footer id="footer" class="clearfix">
      <div id="footer-widgets">

        <div class="container">

        <div id="footer-wrapper">

          <div class="row">
            <div class="col-sm-6 col-md-2">
              <div id="meta-3" class="widget widgetFooter widget_meta">
              <h4 class="widgettitle">Pages:</h4>
              <ul>
    		  <li><a href="index.php"><i class="fa fa-home fa-fw"></i> Home</a></li>
			  <li><a href="privacypolicy.php"><i class="fa fa-link"></i>   Privacy Policy</a></li>
			  <li><a href="contact-us.php"><i class="fa fa-envelope fa-fw"></i> Contact Us</a></li>
             </ul>
</div>      </div> <!-- end widget1 -->

            <div class="col-sm-6 col-md-2">
              		<div id="recent-posts-3" class="widget widgetFooter widget_recent_entries">
                    <h4 class="widgettitle">Social Media :</h4>
                    <ul>
					<li>
				     <a href="#" target="_blank"><i class="fa fa-facebook"></i> Facebook</a>
					</li>
					<li>
				      <a href="#" target="_blank"><i class="fa fa-twitter"></i> Twitter</a>
					</li>
					<li>
				      <a href="#" target="_blank"><i class="fa fa-youtube"></i> Youtube</a>
				   </li>
				</ul>
		</div>            </div> <!-- end widget1 -->

            <div class="col-sm-6 col-md-4">
              <div id="meta-4" class="widget widgetFooter widget_meta">
              <h4 class="widgettitle">Subscribe:</h4>

              <div class="form-group">
                <div class="input-group">
                  <span class="input-group-addon">E-mail:</span>
                  <input class="form-control" placeholder="Write your email .." type="text">
                   <span class="input-group-btn">
                    <button class="btn btn-primary" type="button">Subscribe!</button>
                </div>
              </div>
              </div>
             </div> <!-- end widget1 -->
             <div class="col-sm-6 col-md-2">
              		<div id="recent-posts-3" class="widget widgetFooter widget_recent_entries">
                    <h4 class="widgettitle">Payment Modes:</h4>
                    <ul>
					<li>
				     <a href="#" target="#"><img src="images/payment/visa.png"></a>
				     <a href="#" target="#"><img src="images/payment/mastercard.png"></a>
				 </li>
				 <li>
				     <a href="#" target="#"><img src="images/payment/bhim.png"></a>
				     <a href="#" target="#"><img src="images/payment/instamojo.png"></a>
				   </li>
				</ul>
		</div>
          </div> <!-- end .row -->


        </div> <!-- end #footer-wrapper -->

        </div> <!-- end .container -->
      </div> <!-- end #footer-widgets -->

      <div id="sub-floor">
        <div class="container">
          <div class="row">
            <div class="col-md-4 copyright">
             Copyright CodeMarshalls
            </div>
            <div class="col-md-4 col-md-offset-4 attribution">
             Developed by  <a target="_blank" href="#">Code Marshalls</a>
             </div>
          </div> <!-- end .row -->
        </div>
      </div>
</footer>
	<!--==================================Footer Close=================================-->



	<!--==================================Javscript=================================-->


		<script type="text/javascript" src="js/jquery-lib.js"></script><!-- Jquery Library -->
		<script type="text/javascript" src="js/jquery-migrate-1.3.0.min.js"></script>
		<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?sensor=false"></script>
		<script type="text/javascript" src='js/mapbox.js'></script>
		<script type="text/javascript" src='js/leaflet.markercluster.js'></script>
		<script type="text/javascript" src="js/build.min.js"></script>
		<script type="text/javascript" src="lib/chosen/chosen.jquery.js" ></script>
		<script type="text/javascript" src="js/jquery-ui.js"></script>
		<script type="text/javascript" src="lib/slick/slick.min.js"></script>
		<script type="text/javascript" src="lib/jquerym.menu/js/jquery.mmenu.min.all.js"></script>
		<script type="text/javascript" src="lib/Magnific-Popup-master/jquery.magnific-popup.min.js"></script>
		<script type="text/javascript" src="lib/jQuery.filer-master/js/jquery.filer.min.js"></script>
		<script type="text/javascript" src="js/bootstrap-rating.js"></script>
		<script type="text/javascript" src="lib/popup/js/classie.js"></script> <!-- Popup -->
		<script type="text/javascript" src="lib/popup/js/modalEffects.js"></script> <!-- Popup -->
		<script type="text/javascript" src="js/main.js"></script>

</body>
</html>
